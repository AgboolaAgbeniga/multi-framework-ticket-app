const d="http://localhost:3001",u="ticketapp_auth";function i(){const t=localStorage.getItem(u);if(!t)return null;try{const e=JSON.parse(t);return new Date(e.expiresAt)<new Date?(localStorage.removeItem(u),null):e}catch{return localStorage.removeItem(u),null}}async function s(t,e={}){const r=i(),o=t.startsWith("/users");if(!r&&!o)return{ok:!1,error:"Unauthorized"};try{const n=await fetch(`${d}${t}`,{...e,headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r.token}`},...e.headers}});return n.status===401?(localStorage.removeItem(u),{ok:!1,error:"Token expired"}):n.ok?{ok:!0,data:await n.json()}:{ok:!1,error:"API request failed"}}catch{return{ok:!1,error:"Network error"}}}async function f(){const t=i();return t?s(`/tickets?userId=${t.user.id}`):{ok:!1,error:"Unauthorized"}}async function l(t){const e=i();if(!e)return{ok:!1,error:"Unauthorized"};const r=new Date().toISOString(),o={title:t.title,description:t.description||"",status:t.status,priority:t.priority,userId:e.user.id,createdAt:r,updatedAt:r};return s("/tickets",{method:"POST",body:JSON.stringify(o)})}async function h(t,e){var a;const r=i();if(!r)return{ok:!1,error:"Unauthorized"};const o=await s(`/tickets/${t}`);if(!o.ok)return o;if(((a=o.data)==null?void 0:a.userId)!==r.user.id)return{ok:!1,error:"Unauthorized"};const n={...e,updatedAt:new Date().toISOString()};return s(`/tickets/${t}`,{method:"PATCH",body:JSON.stringify(n)})}async function p(t){var n;const e=i();if(!e)return{ok:!1,error:"Unauthorized"};const r=await s(`/tickets/${t}`);if(!r.ok)return{ok:!1,error:r.error};if(((n=r.data)==null?void 0:n.userId)!==e.user.id)return{ok:!1,error:"Unauthorized"};const o=await s(`/tickets/${t}`,{method:"DELETE"});return{ok:o.ok,data:o.ok,error:o.error}}async function g(){var o,n,a,k;const t=i();if(!t)return{ok:!1,error:"Unauthorized"};const e=await s(`/tickets?userId=${t.user.id}`);return e.ok?{ok:!0,data:{total:((o=e.data)==null?void 0:o.length)||0,open:((n=e.data)==null?void 0:n.filter(c=>c.status==="open").length)||0,inProgress:((a=e.data)==null?void 0:a.filter(c=>c.status==="in_progress").length)||0,closed:((k=e.data)==null?void 0:k.filter(c=>c.status==="closed").length)||0}}:e}export{g as a,f as b,l as c,h as d,p as e};
