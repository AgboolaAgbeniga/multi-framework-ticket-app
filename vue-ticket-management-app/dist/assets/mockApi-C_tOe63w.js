const c="http://localhost:3001",i="ticketapp_auth";function a(){const t=localStorage.getItem(i);if(!t)return null;try{const e=JSON.parse(t);return new Date(e.expiresAt)<new Date?(localStorage.removeItem(i),null):e}catch{return localStorage.removeItem(i),null}}async function n(t,e={}){const o=a(),r=t.startsWith("/users");if(!o&&!r)return{ok:!1,error:"Unauthorized"};try{const s=await fetch(`${c}${t}`,{...e,headers:{"Content-Type":"application/json",...o&&{Authorization:`Bearer ${o.token}`},...e.headers}});return s.status===401?(localStorage.removeItem(i),{ok:!1,error:"Token expired"}):s.ok?{ok:!0,data:await s.json()}:{ok:!1,error:"API request failed"}}catch{return{ok:!1,error:"Network error"}}}async function k(){const t=a();return t?n(`/tickets?userId=${t.user.id}`):{ok:!1,error:"Unauthorized"}}async function d(t){const e=a();if(!e)return{ok:!1,error:"Unauthorized"};const o=new Date().toISOString(),r={title:t.title,description:t.description||"",status:t.status,priority:t.priority,userId:e.user.id,createdAt:o,updatedAt:o};return n("/tickets",{method:"POST",body:JSON.stringify(r)})}async function f(t,e){const o=a();if(!o)return{ok:!1,error:"Unauthorized"};const r=await n(`/tickets/${t}`);if(!r.ok)return r;if(r.data?.userId!==o.user.id)return{ok:!1,error:"Unauthorized"};const s={...e,updatedAt:new Date().toISOString()};return n(`/tickets/${t}`,{method:"PATCH",body:JSON.stringify(s)})}async function l(t){const e=a();if(!e)return{ok:!1,error:"Unauthorized"};const o=await n(`/tickets/${t}`);if(!o.ok)return{ok:!1,error:o.error};if(o.data?.userId!==e.user.id)return{ok:!1,error:"Unauthorized"};const r=await n(`/tickets/${t}`,{method:"DELETE"});return{ok:r.ok,data:r.ok,error:r.error}}async function h(){const t=a();if(!t)return{ok:!1,error:"Unauthorized"};const e=await n(`/tickets?userId=${t.user.id}`);return e.ok?{ok:!0,data:{total:e.data?.length||0,open:e.data?.filter(r=>r.status==="open").length||0,inProgress:e.data?.filter(r=>r.status==="in_progress").length||0,closed:e.data?.filter(r=>r.status==="closed").length||0}}:e}export{h as a,k as b,d as c,f as d,l as e};
